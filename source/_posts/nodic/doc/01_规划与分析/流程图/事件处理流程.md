---
title: 事件处理流程
tags: 传感器
categories: 传感器
abbrlink: 53001
date: 2025-03-16 13:47:14
mermaid: true
---

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
# 事件处理流程

## 版本信息
- 版本：V1.0
- 创建时间：2025年03月17日 12:05
- 创建者：拉琪雅(Lakia)
- 状态：从流程图.md提取

## 1. 事件处理流程图

<div class="mermaid">
graph TD
    A[中断触发] --> B[读取中断源]
    B --> C{中断类型判断}
    C -->|触摸中断| D[读取触摸状态]
    C -->|释放中断| E[读取释放状态]
    C -->|其他中断| F[处理其他状态]
    D --> G{触摸类型判断}
    G -->|按钮触摸| H[处理按钮事件]
    G -->|滑动触摸| I[处理滑动事件]
    H --> J[启动定时器]
    J --> K{持续按压检测}
    K -->|短按释放| L[触发点击事件]
    K -->|持续按压| M{长按阈值检测}
    M -->|达到阈值| N[触发长按事件]
    M -->|未达阈值| K
    I --> O[计算初始位置]
    O --> P[跟踪位置变化]
    P --> Q{方向判断}
    Q -->|上滑| R[触发上滑事件]
    Q -->|下滑| S[触发下滑事件]
    Q -->|左滑| T[触发左滑事件]
    Q -->|右滑| U[触发右滑事件]
</div>

## 2. 中断处理流程

<div class="mermaid">
graph TD
    A[中断触发] --> B[禁用中断]
    B --> C[读取中断源寄存器]
    C --> D{中断类型}
    D -->|触摸事件| E[处理触摸事件]
    D -->|释放事件| F[处理释放事件]
    D -->|其他事件| G[处理其他事件]
    E --> H[清除中断标志]
    F --> H
    G --> H
    H --> I[执行数据采集]
    I --> J[更新设备状态]
    J --> K[触发用户回调]
    K --> L[启用中断]
    L --> M[中断处理完成]
</div>

## 3. 数据采集流程

<div class="mermaid">
graph TD
    A[开始数据采集] --> B[读取状态寄存器]
    B --> C[遍历启用的通道]
    C --> D[读取差值寄存器]
    D --> E{差值 > 触摸阈值?}
    E -->|是| F[更新通道状态为触摸]
    E -->|否| G[更新通道状态为释放]
    F --> H{所有通道处理完毕?}
    G --> H
    H -->|否| C
    H -->|是| I[更新设备数据结构]
    I --> J[触发数据就绪回调]
    J --> K[采集完成]
</div>

## 相关文档
- [事件处理系统设计](/2025/03/16/nodic/doc/01_规划与分析/事件处理系统设计/)
- [阶段4_事件处理](/2025/03/16/nodic/doc/02_实现文档/阶段4_事件处理/)

## 更新历史
- V1.0 (2025-03-17): 初始版本，从流程图.md提取事件处理相关流程